<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>03: The CAR Models</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>







<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">03: The CAR Models</h1>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The <code>*car()</code> functions (<code>rcar()</code>,
<code>car()</code>, <code>mcar()</code>, <code>mstcar()</code>) build
the necessary features needed to run RSTr and places them in the
specified directory. In this vignette, we will talk in detail about each
model, the arguments used in <code>*car()</code> functions, and how to
use them.</p>
</div>
<div id="the-car-functions" class="section level2">
<h2>The <code>*car()</code> functions</h2>
<p>The current version of RSTr features four models to choose from: the
Besag-York-Mollié (BYM) CAR model (also known as just the CAR model),
the Restricted CAR (RCAR) model, the Multivariate CAR (MCAR) model, and
the Multivariate Spatiotemporal CAR (MSTCAR) model. We will now compare
these models and their use cases.</p>
<div id="the-car-model" class="section level3">
<h3>The CAR model</h3>
<p>The CAR model (function call <code>car()</code>) is the basis of all
models used in RSTr. The premise of the CAR is to spatially smooth
estimates across spatial regions using a random effects estimator
<code>Z</code>. The intensity of its smoothing in a region is based on
the event and population counts of that region and the counts in its
neighboring regions.</p>
<p>The CAR model only smooths across spatial regions and not across
sociodemographic groups or time periods. While datasets that include
these stratifications can be run with <code>car()</code>, the user would
be effectively running several concurrent CAR models. The CAR model is
recommended if the user is only has data for one sociodemographic group
of interest and one time-period.</p>
</div>
<div id="the-rcar-model" class="section level3">
<h3>The RCAR model</h3>
<p>The RCAR model (function call <code>rcar()</code>) is the most recent
BYM implementation in RSTr. The RCAR model follows the same general
paradigm as the CAR model, but prevents oversmoothing by capping the
spatial and non-spatial variance. Even though the RCAR only smooths
across spatial regions, the estimates generated by <code>rcar()</code>
are nuanced and strike a happy medium between the use of crude rate
estimates and the oversmoothing of the standard CAR model.</p>
<p>To learn more about restricted CAR models, read
<code>vignette(&quot;RSTr-informativeness&quot;)</code>.</p>
</div>
<div id="the-mcar-model" class="section level3">
<h3>The MCAR model</h3>
<p>The MCAR model (function call <code>mcar()</code>) is an extension of
the CAR model: whereas the CAR model can only smooth over spatial
regions, the MCAR model can smooth over spatial regions and
sociodemographic groups. The MCAR model is ideal for datasets that
include multiple sociodemographic groups. A restricted MCAR (RMCAR)
model is currently under development and will be implemented in RSTr
once its methodology is finalized.</p>
</div>
<div id="the-mstcar-model" class="section level3">
<h3>The MSTCAR model</h3>
<p>The MSTCAR model (function call <code>mstcar()</code>) is an
extension of the MCAR model, allowing for smoothing over spatial
regions, sociodemographic groups, and time periods. The MSTCAR model is
ideal for investigating trends in rate estimates over a specified time
period.</p>
</div>
</div>
<div id="arguments-of-the-car-function" class="section level2">
<h2>Arguments of the <code>*car()</code> function</h2>
<p>All <code>*car()</code> functions provide several arguments:</p>
<ul>
<li><p><code>name</code>: The name of the folder your model information
lives in;</p></li>
<li><p><code>data</code>: The <code>list</code> object containing the
event <code>Y</code> and population <code>n</code> data. For more
information on <code>data</code> setup, read
<code>vignette(&quot;RSTr-event&quot;)</code>;</p></li>
<li><p><code>adjacency</code>: The adjacency structure for your event
and population data. For more information on adjacency structure setup,
read <code>vignette(&quot;RSTr-adjacency&quot;)</code>;</p></li>
<li><p><code>dir</code>: The directory where the model folder lives. By
default, this saves into your temporary directory, so the model
information will be lost after the R session ends. Should you want to
save your model to be analyzed at a later date or ensure that your
samples are intact if R crashes during runtime, specify a different
directory;</p></li>
<li><p><code>seed</code>: Allows the user to specify the random seed
used for replication purposes;</p></li>
<li><p><code>perc_ci</code>: A number between 0 and 1 which specifies
the desired credible interval to use when calculating the relative
precision of estimates. By default, set to 0.95;</p></li>
<li><p><code>iterations</code>: The number of iterations to run the
model for;</p></li>
<li><p><code>show_plots</code>: If set to <code>FALSE</code>, hides
traceplots during model execution;</p></li>
<li><p><code>verbose</code>: If set to <code>FALSE</code>, hides the
progress bar and messages in the console;</p></li>
<li><p><code>ignore_checks</code>: If set to <code>TRUE</code>, skips
model validation;</p></li>
<li><p><code>method</code>: Chooses whether the event data is either
Binomial (<code>&quot;binomial&quot;</code>) or Poisson (<code>&quot;poisson&quot;</code>)
distributed. By default, RSTr uses Binomial updates for event
data;</p></li>
<li><p><code>impute_lb</code>: Specifies a lower bound for imputed data
for event information that is missing or suppressed;</p></li>
<li><p><code>impute_ub</code>: Specifies an upper bound for imputed data
for event information that is missing or suppressed;</p></li>
<li><p><code>inits</code>: This is a <code>list</code> of initial values
for each parameter. This can be specified by the user or generated by
default. For more information on specification of <code>inits</code>,
see <code>vignette(&quot;RSTr-initialvalues&quot;)</code>; and</p></li>
<li><p><code>priors</code>: This is a <code>list</code> of all prior
information for each parameter. This can be specified by the user or
generated by default. For more information on specification of
<code>priors</code>, see <code>vignette(&quot;RSTr-priors&quot;)</code>.</p></li>
</ul>
<p>Most of these arguments are not needed, as the model has defaults for
many of them. <code>rcar()</code> and <code>mstcar()</code> have
additional arguments only used by them:</p>
<ul>
<li><p><code>A</code>: In the RCAR model, describes the limit of the
smoothing intensity between regions;</p></li>
<li><p><code>m0</code>: In the RCAR model, specifies the baseline
neighbor count; and</p></li>
<li><p><code>update_rho</code>: In the MSTCAR model, allows for updates
of the temporal correlation parameter <code>rho</code>. By default, RSTr
does not update <code>rho</code>.</p></li>
</ul>
<p>If you run into errors when trying to initialize your model, read
<code>vignette(&quot;RSTr-troubleshoot&quot;)</code>. Below, we will go into
detail regarding what each argument does specifically and what to keep
in mind when setting these values.</p>
<div id="the-inits-argument" class="section level3">
<h3>The <code>inits</code> argument</h3>
<p><code>inits</code> is a <code>list</code> specifying the starting
values for parameters in the model. Details around the initial value
parameters can be found in
<code>vignette(&quot;RSTr-initialvalues&quot;)</code>.</p>
</div>
<div id="the-priors-argument" class="section level3">
<h3>The <code>priors</code> argument</h3>
<p><code>priors</code> behaves similar to <code>inits</code>, except
that it contains all information related to parameter priors. Details
around the initial value parameters can be found in
<code>vignette(&quot;RSTr-priors&quot;)</code>.</p>
</div>
<div id="the-method-argument" class="section level3">
<h3>The <code>method</code> argument</h3>
<p><code>method</code> offers two values: <code>&quot;binomial&quot;</code> and
<code>&quot;poisson&quot;</code>. These values determine how the data is
transformed and how the <code>lambda</code> Metropolis update is
performed: <code>&quot;binomial&quot;</code> treats the event data as
Binomial-distributed and <code>&quot;poisson&quot;</code> treats the event data as
Poisson-distributed. Depending on your use case, you’ll want to choose
between the two: for example, if you are working with very small
mortality rates, <code>&quot;poisson&quot;</code> will work well, but if you are
working with birth rates, for example, then <code>&quot;binomial&quot;</code> will
work better. Note that <code>&quot;binomial&quot;</code> works in most general use
cases and <code>&quot;poisson&quot;</code> only works well for datasets with small
rates under approximately 1%.</p>
</div>
<div id="m0-and-a" class="section level3">
<h3><code>m0</code> and <code>A</code></h3>
<p><code>m0</code> and <code>A</code> are two components that determine
the intensity of the smoothing of Restricted CAR models. <code>m0</code>
should be a positive scalar, and the size of <code>A</code> is dependent
on the group/time structure of your data: <code>A</code> will be a
positive scalar for region-only models, a <code>vector</code> of size
<code>n_group</code> for region-group models, and a matrix of size
<code>n_group</code> x <code>n_time</code> for region-group-time models.
Note, however, that these informativeness restriction measures are
currently only developed for the CAR model, and restrictions for more
complex models will be added to the RSTr package as their respective
methods are developed.</p>
</div>
<div id="the-update_rho-argument" class="section level3">
<h3>The <code>update_rho</code> argument</h3>
<p>In the MSTCAR model, <code>update_rho</code> is a
<code>logical</code> that specifies whether to calculate estimates for
the temporal correlation <code>rho</code>. By default, it is set to
<code>FALSE</code>. In empirical testing, this estimate was found to not
be very sensitive to changes when specified prudently and also increases
runtime by an order of magnitude due to its complexity.</p>
</div>
<div id="the-seed-argument" class="section level3">
<h3>The <code>seed</code> argument</h3>
<p>Because of the stochastic nature of Bayesian inference and the
inherent instability of the MSTCAR model, replicability is extremely
important. <code>seed</code> allows the user to specify a seed for
generating similar estimates.</p>
</div>
<div id="the-ignore_checks-argument" class="section level3">
<h3>The <code>ignore_checks</code> argument</h3>
<p>As development continues on RSTr, there are occasions where the
checks performed on the inputs of <code>*car()</code> throw an error,
even though you may be certain that all of your inputs are behaving as
expected. To override the checks, you can use the
<code>ignore_checks</code> argument. Set this to <code>TRUE</code> to
skip this step.</p>
</div>
</div>
<div id="closing-thoughts" class="section level2">
<h2>Closing Thoughts</h2>
<p>Initialization is one of the most important steps of running the
model, as it’s where virtually all choices regarding the model are made.
In this vignette, we explored each available type of CAR model in RSTr,
the arguments of the <code>*car()</code> functions, and how to
appropriately choose values for each argument.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
